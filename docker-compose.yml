services:
  skyhelper:
    build:
      context: .
      dockerfile: ./Dockerfile
      target: skyhelper
      secrets:
        - sentry_auth_token
        - turbo_token
      args:
        TURBO_TEAM: ${TURBO_TEAM}
        SENTRY_ORG: ${SENTRY_ORG}
        SENTRY_PROJECT: ${SENTRY_PROJECT}
        TARGET: skyhelper
    container_name: skyhelper
    restart: unless-stopped
    volumes:
      - /root/mybot-data:/app/data
    environment:
      - NODE_ENV
      - TOKEN
      - CLIENT_ID
      - MONGO_CONNECTION
      - PUBLIC_KEY
      - TOPGG_TOKEN
      - DBL_TOKEN
      - GUILD
      - SUGGESTION
      - READY_LOGS
      - ERROR_LOGS
      - COMMANDS_USED
      - CONTACT_US
      - BUG_REPORTS
      - SENTRY_DSN
      - SENTRY_RELEASE
      - NODE_OPTIONS
      - API_ALLOWLIST_KEY
    ports:
      - 5000:5000

  jobs:
    build:
      context: .
      dockerfile: ./Dockerfile
      target: jobs
      secrets:
        - sentry_auth_token
        - turbo_token
      args:
        TURBO_TEAM: ${TURBO_TEAM}
        SENTRY_ORG: ${SENTRY_ORG}
        SENTRY_PROJECT: jobs
        TARGET: jobs
    container_name: skyhelper-jobs
    restart: unless-stopped
    environment:
      - TOKEN
      - MONGO_CONNECTION
      - NODE_ENV
      - ERROR_WEBHOOK
      - JOBS_DEBUG_LOGS
      - SENTRY_DSN_BUN
      - API_ALLOWLIST_KEY
    volumes:
      - /root/mybot-data:/app/data

secrets:
  sentry_auth_token:
    environment: SENTRY_AUTH_TOKEN
  turbo_token:
    environment: TURBO_TOKEN
